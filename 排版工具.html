<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>汉文训读排版工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Hiragino Mincho ProN", "Yu Mincho", "MS Mincho", serif;
            background-color: #f8f3e6;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #8b0000 0%, #a52a2a 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            backdrop-filter: blur(5px);
        }

        .input-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f6f0;
            border-radius: 10px;
            border: 2px solid #d4c9a8;
        }

        .input-section h3 {
            margin-bottom: 15px;
            color: #8b0000;
            font-size: 1.3em;
        }

        .input-tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 2px solid #d4c9a8;
        }

        .input-tab {
            padding: 8px 16px;
            cursor: pointer;
            background: #d4c9a8;
            color: #5d4037;
            border: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            font-weight: bold;
        }

        .input-tab.active {
            background: #8b0000;
            color: white;
        }

        .input-panel {
            display: none;
        }

        .input-panel.active {
            display: block;
        }

        .input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .input-group label {
            font-weight: bold;
            min-width: 80px;
            color: #5d4037;
        }

        .input-group input,
        .input-group textarea {
            flex: 1;
            padding: 10px;
            border: 2px solid #d4c9a8;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
            min-width: 200px;
        }

        .input-group textarea {
            min-height: 120px;
            font-family: monospace;
            line-height: 1.5;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #8b0000;
            box-shadow: 0 0 5px rgba(139, 0, 0, 0.3);
        }

        .format-hint {
            font-size: 0.9em;
            color: #666;
            margin: -10px 0 15px 80px;
            font-family: monospace;
        }

        .checkbox-group {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            padding-left: 80px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .position-controls {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 8px;
        }

        .position-controls h4 {
            margin-bottom: 15px;
            color: #8b0000;
        }

        .position-slider-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 10px;
        }

        .position-slider {
            flex: 1;
            min-width: 250px;
        }

        .position-slider label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #5d4037;
        }

        .position-slider input {
            width: 100%;
        }

        .position-value {
            display: inline-block;
            width: 30px;
            text-align: center;
            color: #8b0000;
            font-weight: bold;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #8b0000 0%, #a52a2a 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .btn-toggle {
            background: linear-gradient(135deg, #1565c0 0%, #2196f3 100%);
            color: white;
        }

        .btn-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .display-section {
            margin-top: 30px;
            padding: 20px;
            background: #fefdf9;
            border-radius: 10px;
            border: 2px solid #d4c9a8;
            min-height: 200px;
        }

        .display-section h3 {
            margin-bottom: 20px;
            color: #8b0000;
            font-size: 1.3em;
        }

        .container {
            margin: 20px 0;
            padding: 20px;
            background: rgba(212, 201, 168, 0.1);
            border-radius: 10px;
            transition: all 0.5s ease;
            display: flex;
            justify-content: center;
        }

        .sentence-box {
            position: relative;
            padding: 30px;
            border: 2px solid rgba(139, 0, 0, 0.6);
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            display: inline-block;
        }

        .sentence-box:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border-color: #8b0000;
        }

        .kanji-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .kanji-container.vertical {
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .kanji-item {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 90px;
            height: 90px;
        }

        .kanji {
            font-size: 48px;
            text-align: center;
            line-height: 1;
            color: #2c2c2c;
            font-weight: bold;
        }

        .ten-ten {
            position: absolute;
            font-size: 16px;
            text-align: center;
            line-height: 24px;
            border-radius: 50%;
            color: #8b0000;
            font-weight: bold;
            width: 24px;
            height: 24px;
        }

        .okurigana {
            position: absolute;
            font-size: 14px;
            text-align: center;
            line-height: 24px;
            border-radius: 50%;
            color: #5d4037;
            font-weight: bold;
            width: 30px;
            height: 24px;
        }

        .show-boxes .ten-ten,
        .show-boxes .okurigana {
            border: 1px solid rgba(139, 0, 0, 0.8);
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .font-size-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .font-size-control label {
            font-weight: bold;
            color: #5d4037;
        }

        .font-size-control input[type="range"] {
            width: 150px;
        }

        .font-size-value {
            font-weight: bold;
            color: #8b0000;
            min-width: 30px;
        }

        .preset-examples {
            margin-top: 20px;
            padding: 15px;
            background: #f9f6f0;
            border-radius: 10px;
            border: 2px solid #d4c9a8;
        }

        .preset-examples h4 {
            margin-bottom: 10px;
            color: #8b0000;
        }

        .preset-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: 8px 16px;
            background: #d4c9a8;
            color: #5d4037;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .preset-btn:hover {
            background: #8b0000;
            color: white;
            transform: translateY(-1px);
        }

        .info-box {
            margin-top: 20px;
            padding: 15px;
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            border-radius: 5px;
        }

        .info-box h4 {
            color: #2e7d32;
            margin-bottom: 10px;
        }

        .info-box ul {
            margin-left: 20px;
            color: #5d4037;
        }

        .info-box li {
            margin-bottom: 5px;
        }

        .error-message {
            color: #d32f2f;
            margin: 10px 0;
            padding: 10px;
            background: #ffebee;
            border-radius: 5px;
            display: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .kanji {
                font-size: 42px;
            }
            
            .input-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .input-group label {
                min-width: auto;
            }
            
            .checkbox-group {
                padding-left: 0;
                justify-content: center;
            }
            
            .format-hint {
                margin-left: 0;
            }
        }
    </style>
<base target="_blank">
</head>
<body>
    <div class="header">
        <h1>汉文训读排版工具</h1>
        <p>支持返点标注、送假名显示和横竖排切换的专业排版系统</p>
    </div>

    <div class="main-container">
        <div class="input-section">
            <h3>📜 输入汉文训读数据</h3>
            
            <!-- 新增标签页切换输入方式 -->
            <div class="input-tabs">
                <button class="input-tab active" onclick="switchInputMode('simple')">简易输入</button>
                <button class="input-tab" onclick="switchInputMode('advanced')">标准格式输入</button>
            </div>
            
            <!-- 简易输入面板 -->
            <div class="input-panel active" id="simple-input">
                <div class="input-group">
                    <label>汉文诗句：</label>
                    <input type="text" id="kanjiInput" placeholder="请输入汉文，如：声声断人肠" />
                </div>
                <div class="input-group">
                    <label>返点标注：</label>
                    <input type="text" id="tenInput" placeholder="对应每个字的返点，如：，二，一（用逗号分隔）" />
                </div>
                <div class="input-group">
                    <label>送假名：</label>
                    <input type="text" id="okuriganaInput" placeholder="对应每个字的送假名，如：，モ，ツ，ノ，ヲ（用逗号分隔）" />
                </div>
            </div>
            
            <!-- 标准格式输入面板 -->
            <div class="input-panel" id="advanced-input">
                <div class="input-group">
                    <label>数据格式：</label>
                    <textarea id="formattedInput" placeholder='请输入或粘贴标准格式数据，例如：
[
    ["声", "", ""],
    ["声", "", "モ"],
    ["断", "二", "ツ"],
    ["人", "", "ノ"],
    ["肠", "一", "ヲ"]
]'></textarea>
                </div>
                <div class="format-hint">
                    格式说明：[["汉字", "返点", "送假名"], ["汉字", "返点", "送假名"], ...]
                </div>
                <div class="error-message" id="formatError">数据格式错误，请检查输入是否符合要求</div>
            </div>
            
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="showTenTen" checked>
                    <label for="showTenTen">显示返点</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="showOkurigana" checked>
                    <label for="showOkurigana">显示送假名</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="showBoxes">
                    <label for="showBoxes">显示小框边框</label>
                </div>
            </div>

            <div class="position-controls">
                <h4>🔧 位置调整：</h4>
                <div class="position-slider-group">
                    <div class="position-slider">
                        <label>返点 X 偏移: <span class="position-value" id="tenXValue">14</span>px</label>
                        <input type="range" id="tenXSlider" min="-60" max="60" value="14" oninput="updatePosition()">
                    </div>
                    <div class="position-slider">
                        <label>返点 Y 偏移: <span class="position-value" id="tenYValue">41</span>px</label>
                        <input type="range" id="tenYSlider" min="-60" max="60" value="41" oninput="updatePosition()">
                    </div>
                </div>
                <div class="position-slider-group">
                    <div class="position-slider">
                        <label>送假名 X 偏移: <span class="position-value" id="okuXValue">15</span>px</label>
                        <input type="range" id="okuXSlider" min="-60" max="60" value="15" oninput="updatePosition()">
                    </div>
                    <div class="position-slider">
                        <label>送假名 Y 偏移: <span class="position-value" id="okuYValue">-17</span>px</label>
                        <input type="range" id="okuYSlider" min="-60" max="60" value="-17" oninput="updatePosition()">
                    </div>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn-primary" onclick="generateKundoku()">📝 生成排版</button>
                <button class="btn-secondary" onclick="clearAll()">🗑️ 清空</button>
                <button class="btn-toggle" onclick="toggleLayout()">🔄 切换横竖排</button>
            </div>

            <div class="preset-examples">
                <h4>🎨 预设示例：</h4>
                <div class="preset-buttons">
                    <button class="preset-btn" onclick="loadExample('example1')">例1：声声断人肠</button>
                    <button class="preset-btn" onclick="loadExample('example2')">例2：春眠不觉晓</button>
                    <button class="preset-btn" onclick="loadExample('example3')">例3：床前明月光</button>
                </div>
            </div>
        </div>

        <div class="display-section">
            <h3>📊 排版预览</h3>
            <div class="container" id="kanjiContainer">
                <!-- 自动生成的句子框 -->
            </div>
            
            <div class="controls">
                <div class="font-size-control">
                    <label>字体大小：</label>
                    <input type="range" id="fontSizeSlider" min="30" max="70" value="48" onchange="updateFontSize()">
                    <span class="font-size-value" id="fontSizeValue">48px</span>
                </div>
            </div>
        </div>

        <div class="info-box">
            <h4>📌 使用说明：</h4>
            <ul>
                <li><strong>输入方式</strong>：支持简易输入（分别输入汉字、返点、送假名）和标准格式输入（直接输入数组格式数据）</li>
                <li><strong>返点标注</strong>：用于标记汉文阅读顺序的特殊符号，如一、二、上、下、レ等</li>
                <li><strong>送假名</strong>：标注在汉字右下角的假名，用于提示汉字的日语读音</li>
                <li><strong>显示控制</strong>：可分别控制返点、送假名及其边框的显示状态</li>
                <li><strong>位置调整</strong>：通过滑块可微调返点和送假名相对于汉字的位置</li>
                <li><strong>横竖排切换</strong>：点击按钮可在横向排列和纵向排列之间切换</li>
            </ul>
        </div>
    </div>

    <script>
        // 当前激活的输入模式
        let currentInputMode = 'simple';
        
        // 预设示例数据
        const examples = {
            example1: [
                ["声", "", ""],
                ["声", "", "モ"],
                ["断", "二", "ツ"],
                ["人", "", "ノ"],
                ["肠", "一", "ヲ"]
            ],
            example2: [
                ["春", "", ""],
                ["眠", "レ", ""],
                ["不", "", "シ"],
                ["觉", "", "メ"],
                ["晓", "", "ギ"]
            ],
            example3: [
                ["床", "", ""],
                ["前", "", "コ"],
                ["明", "", "ノ"],
                ["月", "", "ゲ"],
                ["光", "", "コ"]
            ]
        };

        // 切换输入模式（简易/标准格式）
        function switchInputMode(mode) {
            currentInputMode = mode;
            
            // 更新标签状态
            document.querySelectorAll('.input-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.input-tab[onclick="switchInputMode('${mode}')"]`).classList.add('active');
            
            // 更新面板状态
            document.querySelectorAll('.input-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById(`${mode}-input`).classList.add('active');
            
            // 隐藏错误信息
            document.getElementById('formatError').style.display = 'none';
        }

        // 加载示例
        function loadExample(exampleKey) {
            const exampleData = examples[exampleKey];
            if (!exampleData) return;
            
            // 根据当前输入模式填充不同的输入框
            if (currentInputMode === 'simple') {
                const kanjiArray = exampleData.map(item => item[0]);
                const tenArray = exampleData.map(item => item[1]);
                const okuriganaArray = exampleData.map(item => item[2]);
                
                document.getElementById('kanjiInput').value = kanjiArray.join('');
                document.getElementById('tenInput').value = tenArray.join(',');
                document.getElementById('okuriganaInput').value = okuriganaArray.join(',');
            } else {
                // 格式化JSON以便阅读
                const formattedJson = JSON.stringify(exampleData, null, 4)
                    .replace(/\[\s+/g, '[')
                    .replace(/\s+\]/g, ']')
                    .replace(/\"/g, '"');
                
                document.getElementById('formattedInput').value = formattedJson;
            }
            
            // 生成排版
            renderFromData(exampleData);
        }

        // 从输入生成训读排版
        function generateKundoku() {
            let data = null;
            const errorElement = document.getElementById('formatError');
            errorElement.style.display = 'none';
            
            try {
                if (currentInputMode === 'simple') {
                    // 处理简易输入
                    const kanjiText = document.getElementById('kanjiInput').value.trim();
                    const tenText = document.getElementById('tenInput').value.trim();
                    const okuriganaText = document.getElementById('okuriganaInput').value.trim();
                    
                    if (!kanjiText) {
                        alert('请输入汉文诗句！');
                        return;
                    }

                    const kanjiArray = Array.from(kanjiText);
                    const tenArray = tenText ? tenText.split(',').map(t => t.trim()) : [];
                    const okuriganaArray = okuriganaText ? okuriganaText.split(',').map(o => o.trim()) : [];
                    
                    const maxLength = Math.max(kanjiArray.length, tenArray.length, okuriganaArray.length);
                    
                    while (kanjiArray.length < maxLength) kanjiArray.push('');
                    while (tenArray.length < maxLength) tenArray.push('');
                    while (okuriganaArray.length < maxLength) okuriganaArray.push('');

                    data = kanjiArray.map((kanji, index) => [
                        kanji || '',
                        tenArray[index] || '',
                        okuriganaArray[index] || ''
                    ]);
                } else {
                    // 处理标准格式输入
                    const inputText = document.getElementById('formattedInput').value.trim();
                    if (!inputText) {
                        alert('请输入标准格式数据！');
                        return;
                    }
                    
                    // 解析JSON数据
                    data = JSON.parse(inputText);
                    
                    // 验证数据格式
                    if (!Array.isArray(data) || data.some(item => 
                        !Array.isArray(item) || item.length !== 3 || 
                        typeof item[0] !== 'string' || 
                        typeof item[1] !== 'string' || 
                        typeof item[2] !== 'string'
                    )) {
                        throw new Error('数据格式不正确');
                    }
                }
                
                // 渲染排版
                renderFromData(data);
            } catch (e) {
                console.error('解析数据出错:', e);
                errorElement.textContent = `数据格式错误: ${e.message}`;
                errorElement.style.display = 'block';
                return;
            }
        }

        /**
         * 从标准数据格式渲染训读排版
         * @param {Array} data - 格式为 [[汉字, 返点, 送假名], ...] 的数组
         */
        function renderFromData(data) {
            const container = document.getElementById('kanjiContainer');
            container.innerHTML = '';
            
            const sentenceBox = document.createElement('div');
            sentenceBox.className = 'sentence-box';
            
            const kanjiContainer = document.createElement('div');
            kanjiContainer.className = 'kanji-container vertical';
            
            if (document.getElementById('showBoxes').checked) {
                kanjiContainer.classList.add('show-boxes');
            }
            
            data.forEach(item => {
                const [kanji, tenTen, okurigana] = item;
                const kanjiItem = document.createElement('div');
                kanjiItem.className = 'kanji-item';
                
                let innerHTML = `<div class="kanji">${kanji}</div>`;
                
                const showTenTen = document.getElementById('showTenTen').checked;
                const showOkurigana = document.getElementById('showOkurigana').checked;
                
                if (tenTen && showTenTen) {
                    innerHTML += `<div class="ten-ten">${tenTen}</div>`;
                }
                
                if (okurigana && showOkurigana) {
                    innerHTML += `<div class="okurigana">${okurigana}</div>`;
                }
                
                kanjiItem.innerHTML = innerHTML;
                kanjiContainer.appendChild(kanjiItem);
            });
            
            sentenceBox.appendChild(kanjiContainer);
            container.appendChild(sentenceBox);
            
            updatePosition();
        }

        // 切换横竖排
        function toggleLayout() {
            const container = document.querySelector('.kanji-container');
            if (container) {
                container.classList.toggle('vertical');
                
                container.style.opacity = '0.5';
                setTimeout(() => {
                    container.style.opacity = '1';
                    updatePosition();
                }, 300);
            }
        }

        // 更新字体大小
        function updateFontSize() {
            const slider = document.getElementById('fontSizeSlider');
            const fontSizeValue = document.getElementById('fontSizeValue');
            const kanjiElements = document.querySelectorAll('.kanji');
            
            const fontSize = slider.value + 'px';
            fontSizeValue.textContent = fontSize;
            
            kanjiElements.forEach(element => {
                element.style.fontSize = fontSize;
            });
        }

        // 更新返点和送假名的位置
        function updatePosition() {
            const tenX = parseInt(document.getElementById('tenXSlider').value);
            const tenY = parseInt(document.getElementById('tenYSlider').value);
            const okuX = parseInt(document.getElementById('okuXSlider').value);
            const okuY = parseInt(document.getElementById('okuYSlider').value);
            
            document.getElementById('tenXValue').textContent = tenX;
            document.getElementById('tenYValue').textContent = tenY;
            document.getElementById('okuXValue').textContent = okuX;
            document.getElementById('okuYValue').textContent = okuY;
            
            const tenElements = document.querySelectorAll('.ten-ten');
            const okuElements = document.querySelectorAll('.okurigana');
            const isVertical = document.querySelector('.kanji-container')?.classList.contains('vertical') || false;
            
            tenElements.forEach(el => {
                if (isVertical) {
                    el.style.left = `calc(-15px + ${tenX}px)`;
                    el.style.top = `calc(20px + ${tenY}px)`;
                } else {
                    el.style.left = `calc(10px + ${tenX}px)`;
                    el.style.bottom = `calc(10px + ${tenY}px)`;
                }
            });
            
            okuElements.forEach(el => {
                if (isVertical) {
                    el.style.right = `calc(-15px + ${okuX}px)`;
                    el.style.bottom = `calc(20px + ${okuY}px)`;
                } else {
                    el.style.right = `calc(10px + ${okuX}px)`;
                    el.style.bottom = `calc(10px + ${okuY}px)`;
                }
            });
        }

        // 清空所有内容
        function clearAll() {
            document.getElementById('kanjiInput').value = '';
            document.getElementById('tenInput').value = '';
            document.getElementById('okuriganaInput').value = '';
            document.getElementById('formattedInput').value = '';
            document.getElementById('kanjiContainer').innerHTML = '';
            document.getElementById('formatError').style.display = 'none';
        }

        // 当复选框状态改变时重新渲染
        function handleCheckboxChange() {
            const kanjiContainer = document.querySelector('.kanji-container');
            const isVertical = kanjiContainer ? kanjiContainer.classList.contains('vertical') : true;
            
            generateKundoku();
            
            setTimeout(() => {
                const newContainer = document.querySelector('.kanji-container');
                if (newContainer && isVertical !== newContainer.classList.contains('vertical')) {
                    newContainer.classList.toggle('vertical');
                }
            }, 0);
        }

        // 绑定事件
        document.getElementById('showTenTen').addEventListener('change', handleCheckboxChange);
        document.getElementById('showOkurigana').addEventListener('change', handleCheckboxChange);
        document.getElementById('showBoxes').addEventListener('change', handleCheckboxChange);

        // 页面加载时生成默认示例
        window.onload = function() {
            loadExample('example1');
        };
    </script>
</body>
</html>
